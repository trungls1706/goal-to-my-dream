# 🪣 Amazon S3 – Tổng Quan & Use Cases

## 📌 Use-case thường gặp

| Use-case                  | Mục đích |
|----------------------------|----------|
| Lưu trữ file tĩnh (ảnh, video, tài liệu) | Web/App/Data lake |
| Static Website Hosting     | Host HTML/CSS/JS |
| Backup & Restore           | Copy dữ liệu lên S3 |
| Data Lake cho Big Data     | Kết hợp Athena, Redshift, EMR |
| Phân phối toàn cầu         | Kết hợp CloudFront (CDN) |

---

## 🔐 S3 Security

| Thành phần     | Mục đích |
|----------------|----------|
| IAM policies   | Cấp quyền cho user/role truy cập bucket hoặc object |
| Bucket Policy  | Gán trực tiếp cho bucket, quản lý truy cập người khác |
| ACL            | Mức truy cập legacy – từng object/bucket |
| Block Public Access | Bật mặc định để tránh public nhầm dữ liệu |
| Encryption     | - SSE-S3 (AWS quản key) <br> - SSE-KMS (dùng KMS) <br> - SSE-C (khách tự gửi key) |

---

## 🕒 Versioning
- Giữ mọi phiên bản của object (kể cả object bị xóa → hiện thành delete marker).  
- Không bật mặc định – **Enable = bật vĩnh viễn, không undo được**.  
- Support để:
  - Khôi phục dữ liệu bị ghi đè  
  - Tích hợp với Lifecycle Rules để chuyển phiên bản cũ sang Glacier  

---

## 🔁 Replication

| Loại | Mô tả |
|------|-------|
| **CRR (Cross-Region Replication)** | Replicate dữ liệu từ bucket A sang bucket ở region khác → DR, latency, comply |
| **SRR (Same-Region Replication)** | Backup trong cùng region khác bucket |

- Điều kiện: Bucket bật **versioning**, IAM Role replication.  
- Replication **không áp dụng ngược lại phiên bản cũ**.  

---

## 🗃️ S3 Storage Classes

| Class            | Use-Case | Đặc điểm chính |
|------------------|----------|----------------|
| Standard         | File truy cập thường xuyên | Độ bền 99.999999999% |
| Standard-IA      | Ít truy cập nhưng cần truy xuất nhanh | Phí storage thấp, phí retrieval |
| One Zone-IA      | Như IA nhưng chỉ trong 1 AZ | Nguy cơ mất dữ liệu nếu AZ mất |
| Glacier Flexible | Lưu trữ lâu dài >90 ngày | Truy xuất 1 phút – 12h |
| Glacier Instant  | Archive nhưng truy xuất dưới vài ms | Giá rẻ, thay S3 Standard nếu ít xài |
| Glacier Deep Archive | Lưu trữ lâu dài >180 ngày | Rẻ nhất, truy xuất hàng giờ |
| Intelligent-Tiering | AWS tự chuyển giữa tiers dựa usage | Tối ưu chi phí tự động |

---

## ⚙️ Lifecycle Rules & Object Management
- Lifecycle Rule giúp tự động chuyển lớp lưu trữ hoặc xoá object.  
Ví dụ:
- Sau 30 ngày → chuyển sang Standard-IA  
- Sau 90 ngày → chuyển sang Glacier  
- Sau 365 ngày → Delete  

- Kết hợp với **Versioning**: có thể áp rules khác nhau cho Current version và Previous versions.  

---

## ✅ Tóm tắt ghi nhớ khi thi

| Hỏi                                   | Chọn |
|---------------------------------------|-------|
| Muốn public read file                 | Bucket Policy hoặc ACL |
| Muốn tránh public nhầm                | Block Public Access |
| Bật DR sang region khác               | CRR |
| Muốn giữ lại object cũ/sửa lỗi ghi đè | Versioning |
| Tự động archive để giảm chi phí       | Lifecycle Rule + Intelligent-Tiering hoặc chuyển Glacier |
| Encryption cao cấp dùng KMS           | SSE-KMS |

---

# 🔥 Câu hỏi luyện thi

**Câu 1:**  
Bạn muốn đảm bảo S3 Bucket không bị public nhầm, nên bật tính năng nào?  
✅ Đáp án: **Block Public Access**  

---

**Câu 2:**  
Tính năng nào giúp S3 lưu nhiều phiên bản của object, kể cả khi bị overwrite hoặc delete?  
✅ Đáp án: **Versioning**  

---

**Câu 3:**  
Bạn muốn replicate dữ liệu từ bucket tại Singapore sang bucket tại Tokyo để DR → dùng?  
✅ Đáp án: **Cross-Region Replication (CRR)**  

---

**Câu 4:**  
Storage class nào rẻ nhất, phù hợp lưu trữ >180 ngày và truy xuất hàng tiếng đồng hồ?  
✅ Đáp án: **Glacier Deep Archive**  

---

**Câu 5:**  
Bạn muốn file “ít truy cập” vẫn phải nằm trong nhiều AZ để an toàn, nên dùng class?  
✅ Đáp án: **S3 Standard-IA**  

---

**Câu 6:**  
Bạn cần tự động chuyển object sang Glacier sau 90 ngày → nên dùng tính năng gì?  
✅ Đáp án: **Lifecycle Rule**  

---

**Câu 7:**  
Muốn ứng dụng tự động chọn storage class tối ưu dựa vào usage của object → dùng loại?  
✅ Đáp án: **Intelligent-Tiering**  

---

**Câu 8:**  
Bạn muốn encrypt object S3 bằng AWS KMS keys, nên chọn chế độ nào?  
✅ Đáp án: **SSE-KMS**  

---

**Câu 9:**  
Chính sách nào nên dùng để public một số object cụ thể, không phải cả bucket?  
✅ Đáp án: **ACL (Access Control List)**  

---

**Câu 10:**  
Tính năng nào dưới đây KHÔNG hỗ trợ replication lại các phiên bản trước đó mà chỉ áp dụng từ khi bật?  
✅ Đáp án: **Replication**  

---

# 🔥 Câu hỏi nâng cao

**Câu 1:**  
Bạn muốn cung cấp đường link tạm thời có thời hạn cho user tải file từ S3 (không public bucket) → dùng gì?  
✅ Đáp án: **Pre-Signed URL**  

---

**Câu 2:**  
Bạn muốn tăng tốc độ upload/download file S3 cho người dùng toàn cầu, nên bật tính năng gì?  
✅ Đáp án: **S3 Transfer Acceleration**  

---

**Câu 3:**  
Tính năng nào buộc object không thể bị xoá hoặc chỉnh sửa trong thời gian lock (theo tuân thủ pháp lý)?  
✅ Đáp án: **S3 Object Lock (WORM)**  

---

**Câu 4:**  
Bạn muốn tạo endpoint cố định trong VPC để truy cập S3 mà không đi Internet Gateway?  
✅ Đáp án: **VPC Gateway Endpoint**  

---

**Câu 5:**  
Chức năng MFA Delete trong S3 dùng để làm gì?  
✅ Đáp án: **Bắt buộc nhập mã MFA khi xóa version / tắt versioning**  

---

**Câu 6:**  
S3 Event Notification KHÔNG hỗ trợ gửi thông báo đến dịch vụ nào sau đây?  
- A. Lambda  
- B. SNS  
- C. SQS  
- ✅ D. CloudWatch Logs  

---

**Câu 7:**  
Bạn muốn tạo chính sách giới hạn IAM User chỉ upload file dưới folder `/user1/` trong bucket → dùng?  
✅ Đáp án: **IAM Policy với condition `prefix`**  

---

**Câu 8:**  
Bạn muốn dùng một tên DNS tuỳ chọn như `files.example.com` trỏ tới S3 website hosting → sử dụng record nào?  
✅ Đáp án: **Route53 Alias record tới S3 static website endpoint**  

---

**Câu 9:**  
Tính năng S3 Access Point giúp làm gì?  
✅ Đáp án: **Tạo nhiều endpoint khác nhau với policy riêng cho cùng 1 bucket**  

---

**Câu 10:**  
S3 Object Lock có hai chế độ “Compliance mode” và “Governance mode”. Chế độ nào nghiêm ngặt hơn, không account nào (kể cả root) được xoá trước hạn?  
✅ Đáp án: **Compliance mode**  
